<%- include('layout') %>

<title><%= title %></title>
<%- include('navbar') %>

<div class="container">
    <div class="row">
        <div class="col-md-3 col-10 mt-2 d-flex flex-column ">
            <div class="ms-3">
                <img src="<%= book.image %>" alt="<%= book.title %>" class="image" style="width: 65%;">
            </div>
            <div class="row">
                <div class="col-9 col-md-12 col-lg-9 ">
                    <a href="/signup" class="btn fw-bold mt-2 mb-1 btn-want-to-read" style="background-color: #3f8363; color: #ffffff; border-radius: 15%; width: 100%; display: inline-block; text-align: center; padding: 0.375rem 0.75rem; text-decoration: none;">
                        Want to read
                    </a>
                </div>
            </div>
            <div class="row">
                <div class="col-9 col-md-12 col-lg-9 text-center">
                    <div id="stars">
                        <% for (let i = 0; i < 5; i++) { %>
                            <a href="<%= loggedIn ? '#' : '/signup' %>" class="text-decoration-none star" style="color: #1e1915;" data-index="<%= i + 1 %>">
                                <i class="bi bi-star fs-2"></i>
                            </a>
                        <% } %>
                        <p id="rating-text" style="font-family: Arial, sans-serif; font-weight: 400; font-size: 16px; color: #1e1915; line-height: 23px;">Rate this book</p>
                    </div>
                    
                </div>
            </div>
        </div>

        <div class="col-md-7">
            <div class="mb-1" style="font-family: Georgia, serif; font-weight: 600; font-size: 36px; line-height: 46px; color: #1e1915;">
                    <%= book.title %>
            </div>
            <div class="mb-1">
                <a class="text-decoration-none" href="" style="font-family: Georgia, serif; font-weight: 400; font-size: 20px; line-height: 28px; color: #1e1915;">
                    <%= book.author %>
                </a>
            </div>
            <div class="d-flex align-items-center ">
                <div>
                    <% for (let i = 1; i <= 5; i++) { %>
                        <% if (book.rating >= i) { %>
                            <!-- Full star -->
                            <i class="fas fa-star star"></i>
                        <% } else if (book.rating > (i - 1) && book.rating < i) { %>
                            <!-- Partial star -->
                            <div class="half-star">
                                <i class="far fa-star empty-star"></i>
                                <div class="half-fill" style="width: <%= ((book.rating - (i - 1)) * 100) %>%;">
                                    <i class="fas fa-star star"></i>
                                </div>
                            </div>
                        <% } else { %>
                            <!-- Empty star -->
                            <i class="far fa-star empty-star"></i>
                        <% } %>
                    <% } %>
                </div>
                
                
                
                <div class="d-flex align-items-center justify-content-center">
                    <div class="ms-3" style="font-family: Georgia, serif; font-weight: 600; font-size: 26px; line-height: 37px; color: #1e1915;">
                        <%= book.rating %>
                    </div>
                    <div class="ms-3" style="font-family: Arial, sans-serif; font-weight: 400; font-size: 14px; line-height: 19px; color: #707070;">
                        15,689 ratings
                    </div>
                    <div class="ms-2" style="font-family: Arial, sans-serif; font-weight: 400; font-size: 14px; line-height: 19px; color: #707070;">
                        2,685 reviews
                    </div>
                </div>  
            </div>
            <div class="description-container" id="description-container-<%= book._id %>" style="font-family: Arial, sans-serif; font-weight: 400; font-size: 16px; line-height: 22px; color: #1e1915;">
                <p class="mb-2 short-description">
                    <%- book.description %>
                </p>
                <div class="show-more-button">
                    <a style="font-weight: 600; font-size: 14px; line-height: 20px; color: #1e1915;" class="text-decoration-none show-more-link" data-book-id="<%= book._id %>" href="#">
                        Show more &#9662;
                    </a>
                </div>
            </div>
            <div class="d-flex align-items-center mt-3">
                <div style="font-family: Arial, sans-serif; font-weight: 400; font-size: 14px; line-height: 18px; color: #707070;">Genres:</div>
                <% book.genre.forEach(function(genre) { %>
                    <div class="ms-2" style="font-family: Arial, sans-serif; font-weight: 600; font-size: 14px; line-height: 20px;">
                        <a class="genre-link" href="/genre/<%= genre %>" style="color: #1e1915; text-decoration: underline; text-decoration-color: #409970; text-decoration-thickness: 2px;">
                            <%= genre %>
                        </a>
                    </div>
                <% }); %>
            </div>
            <div class="mt-2" style="font-family: Arial, sans-serif; font-weight: 400; font-size: 14px; line-height: 18px; color: #707070;"><%= book.pages %> pages, <%= book.mediaType %></div>
            <div class="mt-2" style="font-family: Arial, sans-serif; font-weight: 400; font-size: 14px; line-height: 18px; color: #707070;">
                First published <%= new Date(book.publishedDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %>
            </div>
            <hr>
            <div class="d-flex justify-content-between" style="font-weight: 400; font-size: 14px; line-height: 19px; color:#1e1915;">
                <div >7,693 people are currently reading</div>
                <div>180k people want to read</div>
            </div>
            <hr>
            <div style="font-family: Georgia, serif; font-style: italic; font-weight: 600; font-size: 28px; line-height: 38px; color: #1e1915;">Ratings & Reviews</div>
            <div class="d-flex align-items-center justify-content-center">
                <div class="mt-5" style="font-family: Georgia, serif; font-style: italic; font-weight: 600; font-size: 32px; line-height: 46px; color: #1e1915;">
                    What do you think?
                </div>
                
            </div>
            <div class="d-flex row align-items-center justify-content-center">
                <a href="/signup" class="btn mb-2" style="background-color: #1e1915; color: #ffffff; border-radius: 20%; width: 50%;">
                    Write a Review
                </a>
                <hr>
            </div>
            <div style="font-family: Georgia, serif; font-weight: 600; font-size: 20px; line-height: 28px; color: #1e1915;">
                Community Reviews
            </div>
            <div class="d-flex">
                <div>
                    <% for (let i = 1; i <= 5; i++) { %>
                        <% if (book.rating >= i) { %>
                            <!-- Full star -->
                            <i class="fas fa-star star"></i>
                        <% } else if (book.rating > (i - 1) && book.rating < i) { %>
                            <!-- Partial star -->
                            <div class="half-star">
                                <i class="far fa-star empty-star"></i>
                                <div class="half-fill" style="width: <%= ((book.rating - (i - 1)) * 100) %>%;">
                                    <i class="fas fa-star star"></i>
                                </div>
                            </div>
                        <% } else { %>
                            <!-- Empty star -->
                            <i class="far fa-star empty-star"></i>
                        <% } %>
                    <% } %>
                </div>
                <div class="d-flex align-items-center justify-content-center">
                    <div class="ms-3" style="font-family: Georgia, serif; font-weight: 600; font-size: 26px; line-height: 37px; color: #1e1915;">
                        <%= book.rating %>
                    </div>
                    <div class="ms-3" style="font-family: Arial, sans-serif; font-weight: 400; font-size: 14px; line-height: 19px; color: #707070;">
                        15,689 ratings
                    </div>
                    <div class="ms-2" style="font-family: Arial, sans-serif; font-weight: 400; font-size: 14px; line-height: 19px; color: #707070;">
                        2,685 reviews
                    </div>
                </div>     
            </div>
            <div class="rating-bar mt-3">
                <span class="rating-text">5 stars</span>
                <div class="progress">
                    <div class="progress-bar" role="progressbar" style="width: 42%;" aria-valuenow="42" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <span class="rating-text">6,894 (42%)</span>
            </div>
            <div class="rating-bar">
                <span class="rating-text">4 stars</span>
                <div class="progress">
                    <div class="progress-bar" role="progressbar" style="width: 39%;" aria-valuenow="39" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <span class="rating-text">6,497 (39%)</span>
            </div>
            <div class="rating-bar">
                <span class="rating-text">3 stars</span>
                <div class="progress">
                    <div class="progress-bar" role="progressbar" style="width: 14%;" aria-valuenow="14" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <span class="rating-text">2,408 (14%)</span>
            </div>
            <div class="rating-bar">
                <span class="rating-text">2 stars</span>
                <div class="progress">
                    <div class="progress-bar" role="progressbar" style="width: 2%;" aria-valuenow="2" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <span class="rating-text">395 (2%)</span>
            </div>
            <div class="rating-bar">
                <span class="rating-text">1 star</span>
                <div class="progress">
                    <div class="progress-bar" role="progressbar" style="width: 1%;" aria-valuenow="1" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <span class="rating-text">70 (<1%)</span>
            </div>
            
            <div class="search-filter-container">
                <div class="search-input">
                    <i class="bi bi-search"></i>
                    <input type="text" placeholder="Search review text">
                </div>
                <button class="filter-button">
                    <i class="bi bi-funnel"></i> Filters
                </button>
            </div>
            <div class="ms-3" style="font-family: Arial, sans-serif; font-weight: 400; font-size: 14px; line-height: 19px; color: #707070;">
                Displaying 1 - 30 of 2,766 reviews
            </div>
            <div class="row mt-3">
                <div class="col-2">
                    <img src="https://images.gr-assets.com/users/1714842419p6/154684875.jpg" style="border-radius: 50%; width: 60%; object-fit: contain;" >
                        <div style="font-family: Georgia, serif; font-weight: 600; font-size: 14px; line-height: 20px; color: #1e1915;">Nilufer Ozmekik</div>
                        <div class="" style="font-family: Arial, sans-serif; font-weight: 400; font-size: 14px; line-height: 19px; color: #707070;">
                            2,544 reviews
                        </div>
                </div>
                  
                <div class="col-10">
                    <div class="d-flex justify-content-between">
                        <div class="">
                            <% for (let i = 0; i < 5; i++) { %>
                                <i class="bi bi-star fs-6"></i>
                            <% } %>
                        </div>
                        <div>
                            September 4, 2023
                        </div>
                    </div>
                    <div class="mt-2" style="font-family: Arial, sans-serif; font-weight: 400; font-size: 16px; line-height: 23px; color: #1e1915;">
                        this summer will NOT be different if thereâ€™s another cheating tropeâ€¦carley, side EYE. besties keep me posted when this comes outðŸ˜‚thanksðŸ˜™

                        ps: i donâ€™t actually wanna read thisðŸ«£ðŸ«£ðŸ«£
                    </div>
                    <div class="mt-2" style="font-family: Arial, sans-serif; font-weight: 400; font-size: 14px; line-height: 19px; color: #707070;">
                        335 likes 27 comments
                    </div>
                    <div class="mt-2" style="font-family: Arial, sans-serif; font-weight: 600; font-size: 14px; line-height: 20px; color: #1e1915;">
                    <i class="bi bi-hand-thumbs-up"></i> Like
                    <i class="bi bi-chat ms-3"></i> Comment
                    </div>
                <hr>
                </div>
                <div class="col-2">
                    <img src="https://images.gr-assets.com/users/1714842419p6/154684875.jpg" style="border-radius: 50%; width: 60%; object-fit: contain;" >
                        <div style="font-family: Georgia, serif; font-weight: 600; font-size: 14px; line-height: 20px; color: #1e1915;">Nilufer Ozmekik</div>
                        <div class="" style="font-family: Arial, sans-serif; font-weight: 400; font-size: 14px; line-height: 19px; color: #707070;">
                            2,544 reviews
                        </div>
                </div>
                  
                <div class="col-10">
                    <div class="d-flex justify-content-between">
                        <div class="">
                            <% for (let i = 0; i < 5; i++) { %>
                                <i class="bi bi-star fs-6"></i>
                            <% } %>
                        </div>
                        <div>
                            September 4, 2023
                        </div>
                    </div>
                    <div class="mt-2" style="font-family: Arial, sans-serif; font-weight: 400; font-size: 16px; line-height: 23px; color: #1e1915;">
                        this summer will NOT be different if thereâ€™s another cheating tropeâ€¦carley, side EYE. besties keep me posted when this comes outðŸ˜‚thanksðŸ˜™

                        ps: i donâ€™t actually wanna read thisðŸ«£ðŸ«£ðŸ«£
                    </div>
                    <div class="mt-2" style="font-family: Arial, sans-serif; font-weight: 400; font-size: 14px; line-height: 19px; color: #707070;">
                        335 likes 27 comments
                    </div>
                    <div class="mt-2" style="font-family: Arial, sans-serif; font-weight: 600; font-size: 14px; line-height: 20px; color: #1e1915;">
                    <i class="bi bi-hand-thumbs-up"></i> Like
                    <i class="bi bi-chat ms-3"></i> Comment
                    </div>
                <hr>
                </div>
                <div class="d-flex justify-content-between align-items-center">
                    <!-- Horizontal line to the left -->
                    <hr class="flex-grow-1 mr-3" style="border-top: 2px solid #767676;">
                    <div style="font-family: Arial, sans-serif; font-weight: 600; font-size: 14px; line-height: 20px; color: #1e1915;">More Reviews and ratings ></div>
                    <!-- Horizontal line to the right -->
                    <hr class="flex-grow-1 ml-3" style="border-top: 2px solid #767676;">
                </div>
            </div>
        </div>

        <div class="col-md-2 d-flex ">
            <div class="ms-auto">
                <i class="bi bi-share fs-2"></i>
            </div>
            
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const stars = document.querySelectorAll('#stars .bi-star');
        
        stars.forEach((star, index) => {
            star.addEventListener('mouseover', () => {
                highlightStars(index);
            });

            star.addEventListener('mouseout', () => {
                resetStars();
            });
        });

        function highlightStars(index) {
            for (let i = 0; i <= index; i++) {
                stars[i].style.color = '#e87400';
            }
        }

        function resetStars() {
            stars.forEach(star => {
                star.style.color = '';
            });
        }
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const stars = document.querySelectorAll('.star');
        const ratingText = document.getElementById('rating-text');
        const wantToReadButton = document.querySelector('.btn-want-to-read');
        let currentRating = 0; // Variable to keep track of the current rating

        stars.forEach(star => {
            star.addEventListener('click', (event) => {
                event.preventDefault();
                const rating = parseInt(star.getAttribute('data-index'));

                if ('<%= loggedIn %>' === 'true') {
                    if (rating === currentRating) {
                        // If the clicked star's rating matches the current rating, clear the rating
                        currentRating = 0;
                        console.log('The book rating has been cleared');
                        ratingText.textContent = 'Rate this book';
                        wantToReadButton.innerHTML = 'Want to read';
                    } else {
                        // Otherwise, update the rating
                        currentRating = rating;
                        console.log(`The book has received a ${rating} star rating`);
                        ratingText.innerHTML = 'Saved. <a style="color:#333333" href="/write_review">Write a review</a>';
                        wantToReadButton.innerHTML = 'Read <i class="bi bi-pen"></i>';
                    }

                    // Update star classes based on the current rating
                    stars.forEach((s, index) => {
                        const icon = s.querySelector('i');
                        if (index < currentRating) {
                            icon.classList.remove('bi-star');
                            icon.classList.add('bi-star-fill');
                        } else {
                            icon.classList.remove('bi-star-fill');
                            icon.classList.add('bi-star');
                        }
                    });
                } else {
                    window.location.href = '/signup';
                }
            });
        });
    });
</script>
