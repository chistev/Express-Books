<%- include('layout') %>

<title><%= title %></title>
<%- include('navbar') %>

<div class="container " style="width: 70%;">
<div class="row">
    <div class="col-12">
        <a href="<%= `/book/${book._id}/details` %>" class="review_title_link" style="font-family: Georgia, 'Times New Roman', serif; font-weight: 700; font-size: 20px; line-height: 24px; color: #00635d; text-decoration: none;">
            <%= book.title %>
        </a>
        
        <div class="row align-items-center mt-2">
            <div class="col-4 col-md-2">
                <img src="<%= book.image %>" alt="<%= book.title %>" class="img-fluid rounded">
            </div>
            <div class="col-8 col-md-10" style="font-family: Georgia, serif; font-weight: 400; font-size: 14px; line-height: 21px; color: #333333;">
                <p class="text-muted mb-0"> <%= book.author %></p>
            </div>
        </div>
        <hr>
        <div style="font-family: Helvetica, sans-serif; font-weight: 400; font-size: 14px; line-height: 18px; color: #181818;">
            What did you think?
        </div>
        <form id="review-form" action="/submit_review" method="POST">
            <div class="form-group mt-2">
                <textarea id="review" name="review" class="form-control" rows="4" ></textarea>
            </div>
            <hr>
            <a href="#" type="submit" class="btn message-btn" style="background-color: #382110; color: #ffffff;">
                Post
            </a>
        </form>
        
        <div class="d-flex">
            <div class="me-2">
                preview
            </div>
            <div>
                |
            </div>
            <div class="ms-2">
                Remove from my books
            </div>
        </div>
    </div>

    
<script>
    const form = document.getElementById('review-form');
    const submitButton = document.getElementById('submitButton');

    form.addEventListener('submit', function(event) {
        // Trigger TinyMCE to save content to the textarea
        tinymce.triggerSave();
        
        // Check if the textarea is empty
        const review = document.getElementById('review').value;
        if (!review.trim()) {
            event.preventDefault();
            alert('Please fill in the required field.');
        }
    });
</script>

<script>
    // Get the current URL
    const currentUrl = window.location.href;
    console.log('Current URL:', currentUrl);
    // Extract the book ID from the URL
    const bookId = extractBookId(currentUrl);
    console.log('Extracted Book ID:', bookId);
    
    function extractBookId(url) {
    // Split the URL by '/' to get individual segments
    const segments = url.split('/');

    // Find the segment containing the book ID (assuming it's the last segment in the URL)
    const lastSegment = segments[segments.length - 1];

    // Assuming the book ID is present at the end of the URL
    return lastSegment;
}
    const reviewForm = document.getElementById('review-form');
    const reviewTextarea = document.getElementById('review');

    reviewTextarea.addEventListener('input', function(event) {
        // Save content to server after every keystroke or at a suitable interval
        saveReviewContent(reviewTextarea.value);
    });

    function saveReviewContent(content) {
        // Send AJAX request to save content to the server
        fetch(`/save_review_content/${bookId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ content: content }),
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to save review content');
            }
            return response.json();
        })
        .then(data => {
    console.log('Review content saved successfully:', data); // Log success message
})
        .catch(error => {
            console.error('Error saving review content:', error);
        });
    }
</script>
